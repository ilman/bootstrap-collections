tinymce.PluginManager.add('nesia_filemanager', function(editor, url) {
   
   var $ = jQuery;
   var $modal = $('#ajax-modal');

   function openFileManager(){
   	$('body').modalmanager('loading');
			
		setTimeout(
			function(){
				$modal.load(site_url+'member/file?modal=true', '', function(){
					$modal.modal();
				});
			}, 1
		);
   }

   $modal
	.off('click', '.btn-insert')
	.on('click', '.btn-insert', function($event){
		$modal.modal('loading');

		$event.stopPropagation();

		setTimeout(function(){
			image_thumb = attach_app.selected_path+'/'+attach_app.selected_thumb;
			image_file = attach_app.selected_path+'/'+attach_app.selected_file;
			image_name = attach_app.selected_file;

			$item = '<img src="'+image_thumb.replace('_thumb.','_large.')+'" alt="'+image_name+'" />';

			//insert html
			editor.insertContent($item);
				
			$modal.modal('hide');
		}, 1);
	});

   // Add a button that opens a window
	editor.addButton('nesia_filemanager', {
		icon: 'image',
		tooltip: 'Nesia File Manager',
		onclick: function() {
			openFileManager();
		}
	});
});